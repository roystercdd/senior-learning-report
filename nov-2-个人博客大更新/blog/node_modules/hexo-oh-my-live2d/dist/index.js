"use strict";const $=require("fs"),m=require("path"),u="oh-my-live2d/dist/index.min.js";hexo.extend.filter.register("after_generate",function(){const e=hexo.config.OhMyLive2d;if(!(e!=null&&e.enable))return;const h={CDN:e.CDN?e.CDN==="local"?`/pluginsSrc/${u}`:e.CDN:"https://unpkg.com/oh-my-live2d",option:e.option?e.option:{},then:e.then?e.then:""},a=`<script data-pjax src="${h.CDN}"><\/script>`,i=[];for(const o in h.option)if(Object.prototype.hasOwnProperty.call(h.option,o)){const t=h.option[o];if(o==="parentElement")i.push(`parentElement:${t}`);else if(o==="menus")if(typeof t=="object"){const r=[];for(const p in t)if(Object.prototype.hasOwnProperty.call(t,p)){const s=t[p];if(p==="items")if(Array.isArray(s))if(s.some(n=>n.onClick)){const n=[];for(const l of s){const c=[];for(const f in l)if(Object.prototype.hasOwnProperty.call(l,f)){const y=l[f];f==="onClick"?c.push(`${f}:${y}`):c.push(`${f}:${JSON.stringify(y)}`)}n.push(`{${c.join(",")}}`)}r.push(`items:[${n.join(",")}]`)}else r.push(`items:${JSON.stringify(s)}`);else r.push(`items:${s}`);else r.push(`${p}:${JSON.stringify(s)}`)}i.push(`${o}:{${r.join(",")}}`)}else i.push(`${o}:${t}`);else if(o==="tips")if(typeof t=="object"){const r=[];for(const p in t)if(Object.prototype.hasOwnProperty.call(t,p)){const s=t[p];if(p==="idleTips"){const n=[];for(const l in s)if(Object.prototype.hasOwnProperty.call(s,l)){const c=s[l];l==="wordTheDay"?n.push(`wordTheDay:${c}`):l==="message"?Array.isArray(c)?n.push(`message:${JSON.stringify(c)}`):n.push(`message:${c}`):n.push(`${l}:${JSON.stringify(c)}`)}r.push(`idleTips:{${n.join(",")}}`)}else r.push(`${p}: ${JSON.stringify(s)}`)}i.push(`${o}:{${r.join(",")}}`)}else i.push(`${o}:${t}`);else i.push(`${o}:${JSON.stringify(t)}`)}const d="<script>const oml2d = OML2D.loadOml2d({"+i.join(",")+"});"+h.then+"<\/script>";hexo.extend.injector.register("body_end",a,"default"),hexo.extend.injector.register("body_end",d,"default")});hexo.extend.generator.register("oh-my-live2d",()=>{const e=hexo.config.OhMyLive2d;if(!(e!=null&&e.enable)||e.CDN&&e.CDN!=="local")return[];const h=[],a=[];try{h.push({path:`pluginsSrc/${u}`,data:$.readFileSync(m.join(hexo.plugin_dir,u))})}catch{a.push(`The file does not exist: ${u}`)}if(a.length>0){hexo.log.warn("Please reinstall hexo-oh-my-live2d.");for(const i of a)hexo.log.warn(i);process.exit(-1)}return h});
